<div class="tajamar-container">
  <section class="filter-container">
    <div class="filter-group">
      <form #form="ngForm">
        <label for="evento" class="form-label">Filtrar por evento:</label>
        <div class="select-wrapper">
          <select
            id="evento"
            class="custom-select"
            name="evento"
            [(ngModel)]="idEventoSeleccionado"
            (change)="filtrarPorEvento($event)"
          >
            <option [value]="0" disabled>Selecciona una fecha</option>
            @for (evento of eventos; track evento.idEvento) {
              <option [value]="evento.idEvento">
                {{ evento.fechaEvento | date: "EEEE, d 'de' MMMM 'de' y" }}
              </option>
            }
          </select>
        </div>
      </form>
      <div class="filter-mostrar mt-2">
        <button
          type="button"
          class="btn btn-outline-light btn-sm d-flex align-items-center gap-2"
          (click)="limpiarFiltros()"
        >
          <i class="bi bi-arrow-clockwise"></i> Mostrar todos
        </button>
      </div>
    </div>

    <div class="filter-group">
      <form #form="ngForm">
        <label for="deporte" class="form-label">Filtrar por actividad:</label>
        <div class="select-wrapper">
          <select
            id="deporte"
            class="custom-select"
            name="deporte"
            [(ngModel)]="idActividadSeleccionada"
            (change)="filtrarPorActividad($event)"
          >
            <option [value]="0" disabled>Selecciona una actividad</option>
            @for (actividad of actividades; track actividad.idActividad) {
              <option [value]="actividad.idActividad">{{ actividad.nombre }}</option>
            }
          </select>
        </div>
      </form>
      @if (permisosUsuario == 'CAPITAN/ALUMNO' && esCapitanEnEvento) {
        <div class="filter-crear mt-2">
          <button
            type="button"
            class="btn btn-outline-light btn-sm d-flex align-items-center gap-2"
            (click)="formularioCrearResultado()"
          >
            <i class="bi bi-plus-lg"></i> Crear Resultado
          </button>
        </div>
      }
    </div>
  </section>

  <hr class="divider" />

  <section class="results-list">
    <div class="accordion" id="accordionExample">
      @for (resultado of this.resultadosAMostrar; track resultado.idPartidoResultado) {
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapse' + resultado.idPartidoResultado"
              aria-expanded="false"
              [attr.aria-controls]="'collapse' + resultado.idPartidoResultado"
            >
              <div class="d-flex justify-content-between w-100 pe-4">
                <span class="text-start" style="flex: 1">{{
                  resultado.idEquipoLocal | nombreEquipoPipe | async
                }}</span>
                <span class="fw-bold px-3"
                  >{{ resultado.puntosLocal }} - {{ resultado.puntosVisitante }}</span
                >
                <span class="text-end" style="flex: 1">{{
                  resultado.idEquipoVisitante | nombreEquipoPipe | async
                }}</span>
              </div>
            </button>
          </h2>

          <div
            [id]="'collapse' + resultado.idPartidoResultado"
            class="accordion-collapse collapse"
            data-bs-parent="#accordionExample"
          >
            <div class="accordion-body">
              <div class="row">
                <div class="col-md-6 border-end">
                  @for (
                    alumno of resultado.idEquipoLocal | alumnosEquipoPipe | async;
                    track alumno.idAlumno
                  ) {
                    <p class="mb-1 text-start w-100">{{ alumno.usuario }}</p>
                  }
                </div>
                <div class="col-md-6">
                  @for (
                    alumno of resultado.idEquipoVisitante | alumnosEquipoPipe | async;
                    track alumno.idAlumno
                  ) {
                    <p class="mb-1 text-end w-100">{{ alumno.usuario }}</p>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </section>
  <div style="display: none" #formCrearResultados name="formCrearResultados">
    <div class="swal-form" #formNuevoResultado name="formNuevoResultado">
      <label class="form-label">Selecciona el equipo Local:</label>
      <select
        class="form-select puntos"
        (change)="actualizarFiltroEquipos('local')"
        name="equipoLocal"
        #equipoLocal
      >
        @for (equipos of equiposLocales; track equipos.idEquipo) {
          <option value="{{ equipos.idEquipo }}">{{ equipos.nombreEquipo }}</option>
        }
      </select>
      <br />
      <label class="form-label">Selecciona el equipo Visitante:</label>
      <select
        class="form-select puntos"
        (change)="actualizarFiltroEquipos('visitante')"
        name="equipoVisitante"
        #equipoVisitante
      >
        @for (equipos of equiposVisitantes; track equipos.idEquipo) {
          <option value="{{ equipos.idEquipo }}">{{ equipos.nombreEquipo }}</option>
        }
      </select>
      <br />
      <label class="form-label">Puntos Equipo Local:</label>
      <input class="form-control puntos" type="number" name="puntosLocal" #puntosLocal />
      <label class="form-label">Puntos Equipo Visitante:</label>
      <input class="form-control puntos" type="number" name="puntosVisitante" #puntosVisitante />
    </div>
  </div>
</div>
